# Set X-Robots-Tag to 'noindex, nofollow' for development environments and Lagoobernetes autogenerated routes
header_filter_by_lua_block {
  -- escape characters in the hostname
  host = string.gsub(ngx.var.host, "%p", "%%%1")

  -- check to see if we are a development environment
  if (os.getenv("LAGOOBERNETES_ENVIRONMENT_TYPE") and string.match(os.getenv("LAGOOBERNETES_ENVIRONMENT_TYPE"), 'development')) then
    ngx.header["X-Robots-Tag"] = 'noindex, nofollow';
  end

  -- check hostname against autogenerated routes
  if (os.getenv("LAGOOBERNETES_AUTOGENERATED_ROUTES") and string.match(os.getenv("LAGOOBERNETES_AUTOGENERATED_ROUTES"), host)) then
    ngx.header["X-Robots-Tag"] = 'noindex, nofollow';
  end
}
